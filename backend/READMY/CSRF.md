### CSRF

использовал библиотеку [CSURF](https://www.npmjs.com/package/csurf?activeTab=readme) (лучше не нашел)

- в main.ts `app.use(csurf())` по умолчанию `cookie: false` (устанавливать самому)
- если ставить куки true, то при инициализации куки не обновляются
- в опциях можно регулировать куки
  - value откуда получает значение для верификации

```javascript
  value: (req) => req.cookies['__Host-psifi.x-csrf-token'],
    cookie: {
       key: '__Host-psifi.x-csrf-token',
       secure: true,
       sameSite: 'strict',
     },
```

- куки устанавливаю при обновлении сессии при инициализации (в сессию при этом попадает csrfSecret)
- на клиенте отправляю куки `headers: { 'x-csrf-token': csrf }` из библиотеки по умолчанию

- Options:
  The csurf function takes an optional options object that may contain any of the following keys:

  - cookie:
    Determines if the token secret for the user should be stored in a cookie or in req.session. Storing the token secret in a cookie implements the double submit cookie pattern. Defaults to false.

    When set to true (or an object of options for the cookie), then the module changes behavior and no longer uses req.session. This means you are no longer required to use a session middleware. Instead, you do need to use the cookie-parser middleware in your app before this middleware.

    When set to an object, cookie storage of the secret is enabled and the object contains options for this functionality (when set to true, the defaults for the options are used). The options may contain any of the following keys:

    - key - the name of the cookie to use to store the token secret (defaults to '\_csrf').
    - path - the path of the cookie (defaults to '/').
    - signed - indicates if the cookie should be signed (defaults to false).
    - secure - marks the cookie to be used with HTTPS only (defaults to false).
    - maxAge - the number of seconds after which the cookie will expire (defaults to session length).
    - httpOnly - flags the cookie to be accessible only by the web server (defaults to false).
    - sameSite - sets the same site policy for the cookie(defaults to false). This can be set to 'strict', 'lax', 'none', or true (which maps to 'strict').
    - domain - sets the domain the cookie is valid on(defaults to current domain).

  - ignoreMethods:
    An array of the methods for which CSRF token checking will disabled. Defaults to ['GET', 'HEAD', 'OPTIONS'].

  - sessionKey:
    Determines what property ("key") on req the session object is located. Defaults to 'session' (i.e. looks at req.session). The CSRF secret from this library is stored and read as req[sessionKey].csrfSecret.

    If the "cookie" option is not false, then this option does nothing.

  - value:
    Provide a function that the middleware will invoke to read the token from the request for validation. The function is called as value(req) and is expected to return the token as a string.

  The default value is a function that reads the token from the following locations, in order:

```javascript
req.body.\_csrf - typically generated by the body-parser module.
req.query.\_csrf - a built-in from Express.js to read from the URL query string.
req.headers['csrf-token'] - the CSRF-Token HTTP request header.
req.headers['xsrf-token'] - the XSRF-Token HTTP request header.
req.headers['x-csrf-token'] - the X-CSRF-Token HTTP request header.
req.headers['x-xsrf-token'] - the X-XSRF-Token HTTP request header.
```
